import{j as e,i as V,B as T,r as v,h as Z,e as ee,f as se}from"./main-C2EdB3bD.js";import{f as q,a as F,b as k,c as w,d as I,e as A,z as N,u as z,t as R,F as ae,g as te}from"./index-C3WPWvzX.js";import{f as B,g as ne,a as le,c as re,h as ie,i as oe,j as de,b as ce,e as me}from"./queries-UTFv23zn.js";import{I as P}from"./input-B45D5Olh.js";import{C as ue,M as he}from"./map-form-8Vc8hTLY.js";import{c as xe}from"./createLucideIcon-CjGDsaN2.js";import{F as E,X as O}from"./x-BuHdgi7S.js";import{S as pe,T as ge,a as fe,D as je}from"./data-table-skeleton-Dcn48vSp.js";import{M as G,A as be}from"./alert-modal-BolPylOc.js";import{S as K}from"./scroll-area-yFJ859s5.js";import{T as ye,P as Ne}from"./Combination-Y0AnHksN.js";import"./label-9KBkO-sB.js";import"./index-BLaVzQw4.js";import"./react-icons.esm-BJ08uJoe.js";import"./index-DA1tHQxZ.js";import"./index-W54jnlhy.js";import"./chevron-left-CojRQ9nB.js";import"./index-DG7jtevX.js";/**
 * @license lucide-react v0.358.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=xe("CloudUpload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]),Ce=({localFile:n,setLocalFile:r,apiFile:l})=>{const{control:t,setValue:u,formState:o}=q(),h=(a,i)=>{const s=a.target.files;s&&s.length>0&&(r(s[0]),u("fileIds",[s[0].name]),a.target.value="")},p=()=>{r(null),u("fileIds",[])},g=(a,i)=>{const s=i.value.filter(c=>Number(c)!==a);i.onChange(s)},f=(a,i)=>{if(a.key==="Enter"||a.key===","){a.preventDefault();const s=a.currentTarget.value.trim();if(s&&!i.value.includes(s)){const c=[...i.value,s];i.onChange(c),a.currentTarget.value=""}}},b=(a,i)=>{const s=i.value.filter(c=>c!==a);i.onChange(s)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[e.jsx(F,{control:t,name:"name",render:({field:a})=>e.jsxs(k,{children:[e.jsx(w,{children:"Name"}),e.jsx(I,{children:e.jsx(P,{placeholder:"Destination name",...a})}),e.jsx(A,{})]})}),e.jsx(F,{control:t,name:"tags",render:({field:a})=>{var i;return e.jsxs(k,{children:[e.jsx(w,{children:"Tags"}),e.jsx(I,{children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:a.value.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-primary px-3 py-1 text-sm text-white",children:[e.jsx("span",{children:s}),e.jsx(ue,{className:"h-4 w-4 cursor-pointer text-white",onClick:()=>b(s,a)})]},c))}),e.jsx(P,{placeholder:"Enter tags, separate with spaces",onKeyDown:s=>f(s,a)})]})}),e.jsx(A,{children:(i=o.errors.tags)==null?void 0:i.message})]})}}),e.jsx(F,{control:t,name:"fileIds",render:({field:a})=>{var i;return e.jsxs(k,{children:[e.jsx(w,{children:"Gambar Sampul"}),e.jsx(I,{children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 mt-2 text-sm ",children:"PNG, JPG, up to 5MB"}),e.jsxs("label",{htmlFor:"file-upload",className:" flex w-fit cursor-pointer gap-2 rounded-md bg-primary px-4 py-2 text-white dark:text-black",children:[e.jsx(ve,{}),e.jsx("span",{children:"Pilih file"})]}),e.jsx(P,{id:"file-upload",type:"file",accept:"image/*,video/*",onChange:s=>h(s),className:"hidden"}),e.jsxs("div",{className:"mt-4",children:[n&&e.jsxs("div",{className:"mt-4 flex w-1/4 items-center  rounded-lg border p-3 shadow-md",children:[e.jsx(E,{color:"#00808F"}),e.jsx("div",{className:"ml-3 flex-1 overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",title:n.name,children:n.name})}),e.jsx("button",{type:"button",onClick:p,className:"ml-4 text-gray-600 hover:text-red-500",children:e.jsx(O,{})})]}),!n&&l&&a.value.map((s,c)=>e.jsxs("div",{className:"mt-4 flex w-1/4 items-center  rounded-lg border p-3 shadow-md",children:[e.jsx(E,{color:"#00808F"}),e.jsx("div",{className:"ml-3 flex-1 overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",title:l.nama,children:l.nama})}),e.jsx("button",{type:"button",onClick:()=>g(Number(s),a),className:"ml-4 text-gray-600 hover:text-red-500",children:e.jsx(O,{})})]}))]})]})}),e.jsx(A,{children:(i=o.errors.fileIds)==null?void 0:i.message})]})}})]})})},Se=({onLocationChange:n,handleLongitudeChange:r,handleLatitudeChange:l,latitude:t,longitude:u})=>{const{control:o}=q();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-auto lg:h-full",children:[e.jsx(he,{onLocationChange:n,latitude:t,longitude:u}),e.jsx(F,{control:o,name:"latitude",render:({field:h})=>e.jsxs(k,{children:[e.jsx(w,{children:"Latitude"}),e.jsx(I,{children:e.jsx(P,{placeholder:"Enter latitude (e.g., 112.953012)",...h,value:t,onChange:l,type:"text"})}),e.jsx(A,{})]})}),e.jsx(F,{control:o,name:"longitude",render:({field:h})=>e.jsxs(k,{children:[e.jsx(w,{children:"Longitude"}),e.jsx(I,{children:e.jsx(P,{placeholder:"Enter longitude (e.g., -7.942493)",...h,value:u,onChange:r,type:"text"})}),e.jsx(A,{})]})})]})})},Fe=N.object({name:N.string().min(1,{message:"Name is required"})}),_=({modalClose:n,setNewArea:r,index:l,initialData:t,refetch:u,isCreated:o})=>{const{mutateAsync:h}=B(),{mutateAsync:p}=ne(),{destinationId:g}=V(),f=z({resolver:R(Fe),defaultValues:{name:(t==null?void 0:t.name)||""}}),b=async s=>{if(g!=="0"){const c={...t,name:s.name,destinationId:Number(g)};t&&await p({path:{id:t.id},body:c}).then(()=>u())}else l!==void 0&&(r==null||r(c=>c.map((m,L)=>L===l?{...m,name:s.name}:m)))},a=async s=>{g!=="0"?await h({body:{name:s.name,destinationId:Number(g)}}).then(()=>u()):r==null||r(c=>[...c,s])},i=async s=>{try{o?a(s):b(s)}catch(c){console.error("Error submitting form:",c)}n()};return e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-lg p-6 shadow-md",children:[e.jsx("h2",{className:"mb-4 text-center text-xl font-semibold",children:o?"Buat Area":"Ubah Area"}),e.jsx(ae,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(i),className:"space-y-4",children:[e.jsx(F,{control:f.control,name:"name",render:({field:s})=>e.jsxs(k,{children:[e.jsx(w,{className:"mb-2 block ",children:"Name"}),e.jsx(I,{children:e.jsx(P,{placeholder:"Destination name",...s,className:"w-full rounded-md p-2"})}),e.jsx(A,{})]})}),e.jsx(T,{type:"submit",className:"w-full rounded-md bg-primary py-2 text-white transition duration-200 hover:opacity-95",children:o?"Create":"Update"})]})})]})})},ke=({refetch:n,data:r,index:l,setNewArea:t})=>{const{mutateAsync:u}=le(),[o,h]=v.useState(!1),[p,g]=v.useState(!1),{destinationId:f}=V(),[b,a]=v.useState(!1),i=()=>g(!1),s=async()=>{f!=="0"?(a(!0),await u({path:{id:r.id}}).then(()=>{n(),h(!1)}).finally(()=>a(!1))):(t(c=>c.filter((m,L)=>L!==l)),h(!1))};return e.jsxs(e.Fragment,{children:[e.jsx(G,{isOpen:p,onClose:i,className:"!bg-background !px-1",children:e.jsx(K,{className:"h-fit px-6 ",children:e.jsx(_,{refetch:n,modalClose:i,initialData:r,index:l,isCreated:!1,setNewArea:t})})}),e.jsx(be,{isOpen:o,onClose:()=>h(!1),onConfirm:s,loading:b,title:"Apakah Anda Yakin Untuk Melanjutkan?",description:`Ini akan menghapus Point of Interest yang berhubungan dengan Area ${r.name}. Apakah anda yakin?`,cancelTitle:"Batal",continueTitle:"Lanjut"}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(T,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>{g(!0)},children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx(T,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>h(!0),children:e.jsx(ye,{className:"h-5 w-5"})})]})]})},we=(n,r)=>[{id:"number",header:"No",cell:({row:l,table:t})=>{const u=t.getState().pagination.pageIndex,o=t.getState().pagination.pageSize;return u*o+l.index+1},enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"NAME"},{header:"ACTIONS",id:"actions",cell:({row:l})=>e.jsx(ke,{setNewArea:r,refetch:n,data:l.original,index:l.index})}];function Ie({renderModal:n}){const[r,l]=v.useState(!1),t=()=>l(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"text-xs md:text-sm",onClick:()=>l(!0),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"})," Tambah"]}),e.jsx(G,{isOpen:r,onClose:t,className:"!bg-background !px-1",children:e.jsx(K,{className:"h-fit px-6  ",children:n(t)})})]})}function Ae({setNewArea:n,refetch:r}){return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-5",children:[e.jsx("div",{children:e.jsx(Ie,{renderModal:l=>e.jsx(_,{modalClose:l,setNewArea:n,refetch:r,isCreated:!0})})}),e.jsx("div",{className:"w-1/3",children:e.jsx(ge,{placeholder:"Cari destinasi"})})]})}function Pe({setNewArea:n,newArea:r}){const[l]=Z(),{destinationId:t}=V(),u=Number(l.get("page")||1),o=Number(l.get("limit")||10),h={path:{id:Number(t)||0},query:{page:u,take:o}},{data:p,isLoading:g,refetch:f}=re(h),b=(p==null?void 0:p.data)||r,a=p==null?void 0:p.meta,i=(a==null?void 0:a.itemCount)||0,s=Math.ceil(i/o);return g&&t!=="0"?e.jsx("div",{className:"p-5",children:e.jsx(fe,{columnCount:10,filterableColumnCount:2,searchableColumnCount:1})}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{setNewArea:n,refetch:()=>f()}),b&&e.jsx(je,{columns:we(f,n),data:b,pageCount:s})]})}const De=({status:n,handleSaveDraft:r,handlePublish:l})=>{const t="text-white px-2 py-1 rounded-full capitalize",u={draft:`bg-gray-500 ${t}`,published:`bg-green-500 ${t}`},{user:o}=ee();return e.jsxs("div",{className:"h-full w-full rounded-lg border p-6 ",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Status Destinasi"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{className:u[n],children:n})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Author"}),e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm capitalize text-black",children:o==null?void 0:o.username})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-5",children:[e.jsx("button",{onClick:r,className:" underline hover:text-primary",children:"Simpan draft"}),e.jsx(T,{onClick:l,children:"Publish"})]})]})},Me=N.object({name:N.string().min(1,{message:"Masukan Nama Destinasi"}),latitude:N.string({required_error:"Masukan Posisi Latitude Destinasi"}).refine(n=>!isNaN(parseFloat(n)),{message:"Latitude harus berupa angka"}),longitude:N.string({required_error:"Masukan Posisi Longitude Destinasi"}).refine(n=>!isNaN(parseFloat(n)),{message:"Longitude harus berupa angka"}),fileIds:N.array(N.string()).min(1,{message:"Pilih gambar untuk diupload"}),status:N.string().min(1,{message:"Status is required"}),tags:N.array(N.string().min(1,{message:"Masukan Tag Sesuai Destinasi"})).min(1,{message:"Silahkan Masukan Tag lalu tekan enter atau koma (,)"})});function Qe(){const{mutateAsync:n}=ie(),{mutateAsync:r}=B(),{mutateAsync:l}=oe(),{mutateAsync:t}=de(),{mutateAsync:u}=ce(),o=se(),{destinationId:h}=V(),[p,g]=v.useState(""),[f,b]=v.useState(""),[a,i]=v.useState([]),[s,c]=v.useState(null),{data:m,isLoading:L}=me({path:{id:Number(h)||0}}),D=v.useMemo(()=>(m==null?void 0:m.files[0])||{},[m==null?void 0:m.files]),j=z({resolver:R(Me),defaultValues:{name:"",latitude:"",longitude:"",fileIds:[],status:"",tags:[]}});v.useEffect(()=>{m&&(j.reset({name:m.name||"",latitude:String(m.latitude)||"",longitude:String(m.longitude)||"",fileIds:[String(D.id)],status:m.status||"",tags:m.tags||[]}),g(String(m.latitude)),b(String(m.longitude)))},[D,m,j]);const $=(x,d)=>{(x!==p||d!==f)&&(g(x),b(d),j.setValue("latitude",x),j.setValue("longitude",d))},X=x=>{const d=x.target.value;g(d),j.setValue("latitude",d)},H=x=>{const d=x.target.value;b(d),j.setValue("longitude",d)},J=async x=>{var d;try{if(!s){alert("Please upload a file.");return}const S={...x,fileIds:[],tags:x.tags.map(y=>y.trim()).filter(y=>y.length>0),latitude:parseFloat(x.latitude),longitude:parseFloat(x.longitude)};if(s){const C=await l({body:{file:s}});(d=C==null?void 0:C.data)!=null&&d.id&&(S.fileIds=[String(C.data.id)])}const M=await n({body:S});if(M&&M.data){for(const y of a)await r({body:{name:y.name,destinationId:M.data.id}});o.push("/destination")}}catch(S){console.error("Failed to create destination:",S)}},Y=async()=>{var x;try{const d=j.getValues(),S={...d,fileIds:[],tags:d.tags.map(y=>y.trim()).filter(y=>y.length>0),latitude:parseFloat(d.latitude),longitude:parseFloat(d.longitude)};if(s){const C=await l({body:{file:s}});(x=C==null?void 0:C.data)!=null&&x.id&&(S.fileIds=[String(C.data.id)],d.fileIds.length>0&&await u({path:{fileId:Number(D.id)}}))}else S.fileIds=[String(D.id)];const M=await t({path:{id:Number(h)},body:S});console.log("Destination updated successfully!",M),o.push("/destination")}catch(d){console.error("Failed to update destination:",d)}},U=async x=>{try{h==="0"?await J(x):await Y()}catch(d){console.error("Failed to submit form:",d)}},Q=()=>{j.setValue("status","draft"),j.handleSubmit(U)()},W=()=>{j.setValue("status","published"),j.handleSubmit(U)()};return e.jsx("div",{className:"p-6",children:e.jsx(te,{...j,children:e.jsxs("div",{className:"flex flex-col gap-5 lg:grid lg:h-[calc(75vh)] lg:grid-cols-3 lg:grid-rows-[auto,auto,1fr] ",children:[e.jsx("div",{className:" lg:col-span-1 lg:col-start-3 lg:row-span-1",children:e.jsx(De,{status:j.getValues("status"),handlePublish:W,handleSaveDraft:Q})}),e.jsx("div",{className:"row-span-auto rounded-lg border p-4 lg:col-span-1 lg:col-start-3 lg:row-span-2 ",children:e.jsx(Se,{onLocationChange:$,handleLatitudeChange:X,handleLongitudeChange:H,latitude:p,longitude:f})}),e.jsx("div",{className:"row-span-auto h-fit rounded-lg border p-4 lg:col-span-2 lg:row-span-2 lg:row-start-1",children:e.jsx(Ce,{localFile:s,setLocalFile:c,apiFile:D})}),e.jsx("div",{className:"rounded-lg border p-4 lg:col-span-2 lg:row-span-1",children:e.jsx(Pe,{setNewArea:i,newArea:a})})]})})})}export{Qe as default};
