import{r as v,i as S,j as e,B as P,c as M,l as T}from"./main-DlaEAmT8.js";import{P as q}from"./page-head-DfFEqF0e.js";import{A as O,S as A,T as D,P as E,D as k,a as L,B as V}from"./breadcrumbs-CX79stXv.js";import{T as $}from"./scroll-area-lcqOCvDU.js";import{z as r,u as B,t as R,F as z,a as c,b as u,c as m,d as g,I as f,e as x}from"./index-MYUFk-1w.js";import{a as H,d as U,e as _,f as K,g as G}from"./queries-DAFJUSsc.js";import"./chevron-left-BR64V2VW.js";import"./index-DRf4hiWq.js";import"./index-DG6Quuu-.js";const Y=({data:s})=>{const[i]=v.useState(!1),[o,p]=v.useState(!1),l=S(),a=async()=>{};return e.jsxs(e.Fragment,{children:[e.jsx(O,{isOpen:o,onClose:()=>p(!1),onConfirm:a,loading:i}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(P,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>l.push(`/pois/${s.id}`),children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx(P,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>p(!0),children:e.jsx($,{className:"h-5 w-5"})})]})]})},w="text-white px-2 py-1 rounded-lg capitalize",J={draft:`bg-gray-500 ${w}`,published:`bg-green-500 ${w}`},Q=[{id:"number",header:"No",cell:({row:s,table:i})=>{const o=i.getState().pagination.pageIndex,p=i.getState().pagination.pageSize;return o*p+s.index+1},enableSorting:!1,enableHiding:!1},{accessorKey:"title",header:"TITLE"},{accessorKey:"category",header:"CATEGORY"},{accessorKey:"status",header:"STATUS",cell:({row:s})=>{const i=s.getValue("status");return e.jsx("span",{className:J[i],children:i})}},{header:"ACTIONS",id:"actions",cell:({row:s})=>e.jsx(Y,{data:s.original})}],N=v.forwardRef(({className:s,...i},o)=>e.jsx("textarea",{className:M("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:o,...i}));N.displayName="Textarea";const W=r.object({title:r.string().min(1,{message:"Title is required"}),overview:r.string().min(1,{message:"Overview is required"}),about:r.string().min(1,{message:"About is required"}),location:r.string().min(1,{message:"Location is required"}),latitude:r.string({required_error:"Latitude is required"}).refine(s=>!isNaN(parseFloat(s)),{message:"Latitude must be a valid number"}),longitude:r.string({required_error:"Longitude is required"}).refine(s=>!isNaN(parseFloat(s)),{message:"Longitude must be a valid number"}),tags:r.array(r.string().min(1,"Tag cannot be empty")),category:r.string().min(1,{message:"Category is required"}),status:r.string().min(1,{message:"Status is required"}),destinationId:r.number({required_error:"Destination ID is required"}),areaId:r.number({required_error:"Area ID is required"}),mediaFiles:r.array(r.string()),featuredMediaFile:r.array(r.string())}),X=({modalClose:s})=>{const{mutateAsync:i}=H(),{mutateAsync:o}=U(),{mutateAsync:p}=_(),{mutateAsync:l}=K(),a=B({resolver:R(W),defaultValues:{title:"",overview:"",about:"",location:"",latitude:"",longitude:"",tags:[],category:"",status:"draft",destinationId:2,areaId:1,mediaFiles:[],featuredMediaFile:[]}}),y=async(t,h=!1)=>{var d,F;const j=(d=t.target.files)==null?void 0:d[0];if(j)try{const n=await i({body:{file:j}});if((F=n==null?void 0:n.data)!=null&&F.id)if(h)a.setValue("featuredMediaFile",[String(n.data.id)]),console.log("Featured Media File uploaded:",n.data.id);else{const C=a.getValues("mediaFiles")||[];a.setValue("mediaFiles",[...C,String(n.data.id)]),console.log("Media File uploaded:",n.data.id)}else console.error("File upload failed: Missing ID in response")}catch(I){console.error("Failed to upload file:",I)}},b=async t=>{var h;try{if(!t.mediaFiles.length||!t.featuredMediaFile.length){a.setError("mediaFiles",{type:"manual",message:"Both media files and featured media are required"});return}const j={...t,latitude:parseFloat(t.latitude),longitude:parseFloat(t.longitude)},d=await o({body:j}),F=(h=d==null?void 0:d.data)==null?void 0:h.id;if(!F)throw new Error("Failed to create POI: Missing ID in response");const I=t.mediaFiles.map(async n=>{const C=parseInt(n,10);if(isNaN(C))throw new Error(`Invalid media file ID: ${n}`);return p({path:{poiId:F,fileId:C}})});if(t.featuredMediaFile[0]){const n=parseInt(t.featuredMediaFile[0],10);if(isNaN(n))throw new Error(`Invalid featured file ID: ${t.featuredMediaFile[0]}`);await l({path:{poiId:F,fileId:n}})}await Promise.all(I),console.log("POI created and files linked successfully!"),s()}catch(j){console.error("Failed to create POI:",j),a.setError("root",{type:"manual",message:"Failed to create POI. Please try again."})}};return e.jsx(z,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(b),children:[e.jsx(c,{control:a.control,name:"title",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Title"}),e.jsx(g,{children:e.jsx(f,{placeholder:"Enter title",...t})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"overview",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Overview"}),e.jsx(g,{children:e.jsx(f,{placeholder:"Enter overview",...t})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"about",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Description"}),e.jsx(g,{children:e.jsx(N,{placeholder:"Enter detailed description",...t})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"latitude",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Latitude"}),e.jsx(g,{children:e.jsx(f,{placeholder:"Enter latitude (e.g., 112.953012)",...t,type:"number"})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"longitude",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Longitude"}),e.jsx(g,{children:e.jsx(f,{placeholder:"Enter longitude (e.g., -7.942493)",...t,type:"number"})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"tags",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Tags"}),e.jsx(g,{children:e.jsx(f,{...t,placeholder:"Enter tags, separate with spaces",onChange:h=>{const j=h.target.value.split(/\s+/).map(d=>d.trim()).filter(d=>d.length>0);t.onChange(j)}})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"mediaFiles",render:()=>e.jsxs(u,{children:[e.jsx(m,{children:"Media Files"}),e.jsx(g,{children:e.jsx(f,{type:"file",accept:"image/*,video/*",onChange:t=>y(t)})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"featuredMediaFile",render:()=>e.jsxs(u,{children:[e.jsx(m,{children:"Featured Media"}),e.jsx(g,{children:e.jsx(f,{type:"file",accept:"image/*,video/*",onChange:t=>y(t,!0)})}),e.jsx(x,{})]})}),e.jsx(c,{control:a.control,name:"category",render:({field:t})=>e.jsxs(u,{children:[e.jsx(m,{children:"Category"}),e.jsx(g,{children:e.jsxs("select",{...t,className:"form-select",children:[e.jsx("option",{value:"",children:"Select a category"}),e.jsx("option",{value:"Attraction",children:"Attraction"}),e.jsx("option",{value:"Hotel",children:"Hotel"}),e.jsx("option",{value:"Restaurant",children:"Restaurant"})]})}),e.jsx(x,{})]})}),e.jsx("div",{}),e.jsx("div",{className:"submit-button-container",children:e.jsx(P,{type:"submit",disabled:a.getValues("mediaFiles").length===0&&!a.getValues("featuredMediaFile"),onClick:()=>console.log("Submit button clicked"),children:"Submit"})})]})})},Z=X;function ee(){return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-5",children:[e.jsx("div",{className:"flex flex-1 gap-4",children:e.jsx(D,{placeholder:"Cari Point Of Interest"})}),e.jsx("div",{className:"flex gap-3",children:e.jsx(E,{renderModal:s=>e.jsx(Z,{modalClose:s})})})]})}function te({pois:s,pageCount:i}){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),s&&e.jsx(k,{columns:Q,data:s,pageCount:i})]})}function ue(){const[s]=T(),i=Number(s.get("page")||1),o=Number(s.get("limit")||10),p={query:{page:i,take:o}},{data:l,isLoading:a}=G(p),y=l==null?void 0:l.data,b=l==null?void 0:l.meta,t=(b==null?void 0:b.itemCount)||0,h=Math.ceil(t/o);return a?e.jsx("div",{className:"p-5",children:e.jsx(L,{columnCount:10,filterableColumnCount:2,searchableColumnCount:1})}):e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx(q,{title:"Destination Management | App"}),e.jsx(V,{items:[{title:"Dashboard",link:"/"},{title:"POIs",link:"/pois"}]}),e.jsx(te,{pois:y,pageCount:h})]})}export{ue as default};
