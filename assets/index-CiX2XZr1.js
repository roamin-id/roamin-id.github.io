import{r as C,i as S,j as e,B as b,l as D}from"./main-DlaEAmT8.js";import{P as I}from"./page-head-DfFEqF0e.js";import{A as T,S as A,T as P,P as v,D as L,a as w,B as q}from"./breadcrumbs-CX79stXv.js";import{T as E}from"./scroll-area-lcqOCvDU.js";import{z as l,u as M,t as k,F as U,a as g,b as x,c as p,d as h,I as j,e as f}from"./index-MYUFk-1w.js";import{u as V,a as z,b as B}from"./queries-DAFJUSsc.js";import"./chevron-left-BR64V2VW.js";import"./index-DRf4hiWq.js";import"./index-DG6Quuu-.js";const K=({data:s})=>{const[n]=C.useState(!1),[c,t]=C.useState(!1),i=S(),u=async()=>{};return e.jsxs(e.Fragment,{children:[e.jsx(T,{isOpen:c,onClose:()=>t(!1),onConfirm:u,loading:n}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(b,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>i.push(`/destination/${s.id}`),children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx(b,{variant:"ghost",className:"flex h-8 w-auto items-start",onClick:()=>t(!0),children:e.jsx(E,{className:"h-5 w-5"})})]})]})},F="text-white px-2 py-1 rounded-lg capitalize",O={draft:`bg-gray-500 ${F}`,published:`bg-green-500 ${F}`},$=[{id:"number",header:"No",cell:({row:s,table:n})=>{const c=n.getState().pagination.pageIndex,t=n.getState().pagination.pageSize;return c*t+s.index+1},enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"NAME"},{accessorKey:"latitude",header:"LATITUDE"},{accessorKey:"longitude",header:"LONGITUDE"},{accessorKey:"status",header:"STATUS",cell:({row:s})=>{const n=s.getValue("status");return e.jsx("span",{className:O[n],children:n})}},{header:"ACTIONS",id:"actions",cell:({row:s})=>e.jsx(K,{data:s.original})}],H=l.object({name:l.string().min(1,{message:"Name is required"}),latitude:l.string({required_error:"Latitude is required"}).refine(s=>!isNaN(parseFloat(s)),{message:"Latitude must be a valid number"}),longitude:l.string({required_error:"Longitude is required"}).refine(s=>!isNaN(parseFloat(s)),{message:"Longitude must be a valid number"}),fileIds:l.array(l.string()),status:l.string().min(1,{message:"Status is required"}),tags:l.array(l.string().min(1,"Tag cannot be empty"))}),R=({modalClose:s})=>{const{mutateAsync:n}=V(),{mutateAsync:c}=z(),t=M({resolver:k(H),defaultValues:{name:"",latitude:"",longitude:"",fileIds:[],status:"draft",tags:[]}}),i=async a=>{var o,d;const r=(o=a.target.files)==null?void 0:o[0];if(r)try{const m=await c({body:{file:r}});if(console.log("Uploaded file response:",m),(d=m==null?void 0:m.data)!=null&&d.id){const N=t.getValues("fileIds")||[];t.setValue("fileIds",[...N,String(m.data.id)])}else console.error("File upload failed: Missing ID in response.")}catch(y){console.error("Failed to upload file:",y)}},u=async a=>{try{const r={...a,fileIds:t.getValues("fileIds"),tags:a.tags.map(o=>o.trim()).filter(o=>o.length>0),latitude:parseFloat(a.latitude),longitude:parseFloat(a.longitude)};await n({body:r}),console.log("Destination created successfully!"),s()}catch(r){console.error("Failed to create destination:",r)}};return e.jsx(U,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(u),children:[e.jsx(g,{control:t.control,name:"name",render:({field:a})=>e.jsxs(x,{children:[e.jsx(p,{children:"Name"}),e.jsx(h,{children:e.jsx(j,{placeholder:"Destination name",...a})}),e.jsx(f,{})]})}),e.jsx(g,{control:t.control,name:"latitude",render:({field:a})=>e.jsxs(x,{children:[e.jsx(p,{children:"Latitude"}),e.jsx(h,{children:e.jsx(j,{placeholder:"Enter latitude (e.g., 112.953012)",...a,type:"text"})}),e.jsx(f,{})]})}),e.jsx(g,{control:t.control,name:"longitude",render:({field:a})=>e.jsxs(x,{children:[e.jsx(p,{children:"Longitude"}),e.jsx(h,{children:e.jsx(j,{placeholder:"Enter longitude (e.g., -7.942493)",...a,type:"text"})}),e.jsx(f,{})]})}),e.jsx(g,{control:t.control,name:"tags",render:({field:a})=>e.jsxs(x,{children:[e.jsx(p,{children:"Tags"}),e.jsx(h,{children:e.jsx(j,{...a,placeholder:"Enter tags, separate with spaces",onChange:r=>{const o=r.target.value.split(/\s+/).map(d=>d.trim()).filter(d=>d.length>0);a.onChange(o)}})}),e.jsx(f,{})]})}),e.jsx(g,{control:t.control,name:"fileIds",render:()=>e.jsxs(x,{children:[e.jsx(p,{children:"Files"}),e.jsx(h,{children:e.jsx(j,{type:"file",accept:"image/*,video/*",onChange:i})}),e.jsx(f,{})]})}),e.jsx(b,{type:"submit",children:"Create Destination"})]})})},_=R;function G(){return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-5",children:[e.jsx("div",{className:"flex flex-1 gap-4",children:e.jsx(P,{placeholder:"Cari destinasi"})}),e.jsx("div",{className:"flex gap-3",children:e.jsx(v,{renderModal:s=>e.jsx(_,{modalClose:s})})})]})}function J({destinations:s,pageCount:n}){return e.jsxs(e.Fragment,{children:[e.jsx(G,{}),s&&e.jsx(L,{columns:$,data:s,pageCount:n})]})}function ne(){const[s]=D(),n=Number(s.get("page")||1),c=Number(s.get("limit")||10),t={query:{page:n,take:c}},{data:i,isLoading:u}=B(t),a=i==null?void 0:i.data,r=i==null?void 0:i.meta,o=(r==null?void 0:r.itemCount)||0,d=Math.ceil(o/c);return u?e.jsx("div",{className:"p-5",children:e.jsx(w,{columnCount:10,filterableColumnCount:2,searchableColumnCount:1})}):e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsx(I,{title:"Destination Management | App"}),e.jsx(q,{items:[{title:"Dashboard",link:"/"},{title:"Destinations",link:"/destination"}]}),e.jsx(J,{destinations:a,pageCount:d})]})}export{ne as default};
